# CLI Reference for Dicee Project
# Auto-generated from actual CLI --help output
# Last updated: 2024-12-02
#
# This file provides accurate, machine-readable CLI commands for agents
# working in this project. Always prefer these documented commands over
# training data, as CLIs evolve rapidly.

meta:
  generated: "2025-12-11"
  supabase_version: "2.62.10"
  wrangler_version: "4.51.0"
  infisical_version: "0.43.35"
  note: "Vercel fully deprecated - using Cloudflare Pages. PartyKit also deprecated."

# Project-specific Cloudflare configuration
cloudflare_project:
  account_id: "13eb584192d9cefb730fde0cfd271328"
  zone_id: "8d5f44e67ab4b37e47b034ff48b03099"
  domain: "jefahnierocks.com"
  production_url: "gamelobby.jefahnierocks.com"
  legacy_url: "dicee.jefahnierocks.com"  # Redirects to gamelobby

  # Cloudflare Pages (SvelteKit frontend)
  pages:
    project_name: "gamelobby-pages"
    package: "packages/web"
    adapter: "@sveltejs/adapter-cloudflare"
    build_output: ".svelte-kit/cloudflare"
    compatibility_flags: ["nodejs_compat"]
    service_binding: "GAME_WORKER"  # Binds to gamelobby worker
    plan_doc: "docs/unified-cloudflare-stack.md"
    ui_doc: "docs/lobby-ux-ui-refactor.md"

  # Durable Objects game lobby infrastructure
  durable_objects:
    worker_name: "gamelobby"
    package: "packages/cloudflare-do"
    production_url: "gamelobby.jefahnierocks.com"
    classes:
      - name: "GlobalLobby"
        type: "singleton"
        purpose: "Global chat, presence, room browser"
        routes: ["/lobby", "/lobby/*"]
      - name: "GameRoom"
        type: "per-room"
        purpose: "Game state, multiplayer sync"
        routes: ["/room/:code"]
    storage: "SQLite (via new_sqlite_classes)"
    hibernation: true
    auth_flow: "Users land on gamelobby → lobby with chat + game list → select game (dicee) → create/join room → play"

# Project-specific Infisical configuration
infisical_project:
  name: "dicee"
  slug: "dicee-dsmc"
  project_id: "b15c7b9c-4e1f-447a-a326-4c382b6db706"
  instance: "https://infisical.jefahnierocks.com"
  environments:
    - name: "Development"
      slug: "dev"
    - name: "Staging"
      slug: "staging"
    - name: "Production"
      slug: "prod"

# ============================================================================
# SUPABASE CLI
# ============================================================================

supabase:
  version: "2.62.10"

  global_flags:
    - flag: "--create-ticket"
      description: "Create a support ticket for any CLI error"
    - flag: "--debug"
      description: "Output debug logs to stderr"
    - flag: "--dns-resolver [native|https]"
      description: "Lookup domain names using specified resolver (default: native)"
    - flag: "--experimental"
      description: "Enable experimental features"
    - flag: "--network-id <string>"
      description: "Use specified docker network instead of generated one"
    - flag: "-o, --output [env|pretty|json|toml|yaml]"
      description: "Output format of status variables (default: pretty)"
    - flag: "--profile <string>"
      description: "Use specific profile for Supabase API (default: supabase)"
    - flag: "--workdir <string>"
      description: "Path to Supabase project directory"
    - flag: "--yes"
      description: "Answer yes to all prompts"

  commands:
    # --- Quick Start ---
    bootstrap:
      description: "Bootstrap a Supabase project from a starter template"
      usage: "supabase bootstrap"

    # --- Local Development ---
    init:
      description: "Initialize a local project"
      usage: "supabase init"

    start:
      description: "Start containers for Supabase local development"
      usage: "supabase start [flags]"
      flags:
        - flag: "-x, --exclude <strings>"
          description: "Names of containers to not start [gotrue,realtime,storage-api,imgproxy,kong,mailpit,postgrest,postgres-meta,studio,edge-runtime,logflare,vector,supavisor]"
        - flag: "--ignore-health-check"
          description: "Ignore unhealthy services and exit 0"

    stop:
      description: "Stop all local Supabase containers"
      usage: "supabase stop"

    status:
      description: "Show status of local Supabase containers"
      usage: "supabase status"

    link:
      description: "Link to a Supabase project"
      usage: "supabase link [flags]"
      flags:
        - flag: "-p, --password <string>"
          description: "Password to your remote Postgres database"
        - flag: "--project-ref <string>"
          description: "Project ref of the Supabase project"
        - flag: "--skip-pooler"
          description: "Use direct connection instead of pooler"

    unlink:
      description: "Unlink a Supabase project"
      usage: "supabase unlink"

    login:
      description: "Authenticate using an access token"
      usage: "supabase login"

    logout:
      description: "Log out and delete access tokens locally"
      usage: "supabase logout"

    services:
      description: "Show versions of all Supabase services"
      usage: "supabase services"

    # --- Database Commands ---
    db:
      description: "Manage Postgres databases"
      subcommands:
        diff:
          description: "Diffs the local database for schema changes"
          usage: "supabase db diff"

        dump:
          description: "Dumps data or schemas from the remote database"
          usage: "supabase db dump"

        lint:
          description: "Checks local database for typing error"
          usage: "supabase db lint"

        pull:
          description: "Pull schema from the remote database"
          usage: "supabase db pull [migration name] [flags]"
          flags:
            - flag: "--db-url <string>"
              description: "Pulls from database specified by connection string (must be percent-encoded)"
            - flag: "--linked"
              description: "Pulls from linked project (default: true)"
            - flag: "--local"
              description: "Pulls from local database"
            - flag: "-p, --password <string>"
              description: "Password to remote Postgres database"
            - flag: "-s, --schema <strings>"
              description: "Comma separated list of schema to include"

        push:
          description: "Push new migrations to the remote database"
          usage: "supabase db push [flags]"
          flags:
            - flag: "--db-url <string>"
              description: "Pushes to database specified by connection string (must be percent-encoded)"
            - flag: "--dry-run"
              description: "Print migrations that would be applied without applying"
            - flag: "--include-all"
              description: "Include all migrations not found on remote history table"
            - flag: "--include-roles"
              description: "Include custom roles from supabase/roles.sql"
            - flag: "--include-seed"
              description: "Include seed data from config"
            - flag: "--linked"
              description: "Pushes to linked project (default: true)"
            - flag: "--local"
              description: "Pushes to local database"
            - flag: "-p, --password <string>"
              description: "Password to remote Postgres database"

        reset:
          description: "Resets the local database to current migrations"
          usage: "supabase db reset"

        start:
          description: "Starts local Postgres database"
          usage: "supabase db start"

    # --- Migration Commands ---
    migration:
      description: "Manage database migration scripts"
      aliases: ["migrations"]
      subcommands:
        down:
          description: "Resets applied migrations up to the last n versions"
          usage: "supabase migration down"

        fetch:
          description: "Fetch migration files from history table"
          usage: "supabase migration fetch"

        list:
          description: "List local and remote migrations"
          usage: "supabase migration list"

        new:
          description: "Create an empty migration script"
          usage: "supabase migration new <name>"

        repair:
          description: "Repair the migration history table"
          usage: "supabase migration repair"

        squash:
          description: "Squash migrations to a single file"
          usage: "supabase migration squash"

        up:
          description: "Apply pending migrations to local database"
          usage: "supabase migration up"

    # --- Code Generation ---
    gen:
      description: "Run code generation tools"
      subcommands:
        bearer-jwt:
          description: "Generate a Bearer Auth JWT for accessing Data API"
          usage: "supabase gen bearer-jwt"

        signing-key:
          description: "Generate a JWT signing key"
          usage: "supabase gen signing-key"

        types:
          description: "Generate types from Postgres schema"
          usage: "supabase gen types [flags]"
          examples:
            - "supabase gen types --local"
            - "supabase gen types --linked --lang=go"
            - "supabase gen types --project-id abc-def-123 --schema public --schema private"
            - "supabase gen types --db-url 'postgresql://...' --schema public --schema auth"
          flags:
            - flag: "--db-url <string>"
              description: "Generate types from a database url"
            - flag: "--lang [typescript|go|swift]"
              description: "Output language of generated types (default: typescript)"
            - flag: "--linked"
              description: "Generate types from linked project"
            - flag: "--local"
              description: "Generate types from local dev database"
            - flag: "--postgrest-v9-compat"
              description: "Generate types compatible with PostgREST v9 and below"
            - flag: "--project-id <string>"
              description: "Generate types from a project ID"
            - flag: "--query-timeout <duration>"
              description: "Maximum timeout for database query (default: 15s)"
            - flag: "-s, --schema <strings>"
              description: "Comma separated list of schema to include"
            - flag: "--swift-access-control [internal|public]"
              description: "Access control for Swift generated types (default: internal)"

    # --- Edge Functions ---
    functions:
      description: "Manage Supabase Edge functions"
      subcommands:
        delete:
          description: "Delete a Function from Supabase"
          usage: "supabase functions delete <name>"

        deploy:
          description: "Deploy a Function to the linked Supabase project"
          usage: "supabase functions deploy [Function name] [flags]"
          flags:
            - flag: "--import-map <string>"
              description: "Path to import map file"
            - flag: "-j, --jobs <uint>"
              description: "Maximum number of parallel jobs (default: 1)"
            - flag: "--no-verify-jwt"
              description: "Disable JWT verification for the Function"
            - flag: "--project-ref <string>"
              description: "Project ref of the Supabase project"
            - flag: "--prune"
              description: "Delete Functions that exist in Supabase but not locally"
            - flag: "--use-api"
              description: "Bundle functions server-side without using Docker"

        download:
          description: "Download a Function from Supabase"
          usage: "supabase functions download <name>"

        list:
          description: "List all Functions in Supabase"
          usage: "supabase functions list"

        new:
          description: "Create a new Function locally"
          usage: "supabase functions new <name>"

        serve:
          description: "Serve all Functions locally"
          usage: "supabase functions serve"

    # --- Secrets ---
    secrets:
      description: "Manage Supabase secrets"
      flags:
        - flag: "--project-ref <string>"
          description: "Project ref of the Supabase project"
      subcommands:
        list:
          description: "List all secrets on Supabase"
          usage: "supabase secrets list"

        set:
          description: "Set a secret(s) on Supabase"
          usage: "supabase secrets set <KEY=VALUE>..."

        unset:
          description: "Unset a secret(s) on Supabase"
          usage: "supabase secrets unset <KEY>..."

    # --- Storage ---
    storage:
      description: "Manage Supabase Storage objects"
      flags:
        - flag: "--linked"
          description: "Connects to Storage API of linked project (default: true)"
        - flag: "--local"
          description: "Connects to Storage API of local database"
      subcommands:
        cp:
          description: "Copy objects from src to dst path"
          usage: "supabase storage cp <src> <dst>"

        ls:
          description: "List objects by path prefix"
          usage: "supabase storage ls [path]"

        mv:
          description: "Move objects from src to dst path"
          usage: "supabase storage mv <src> <dst>"

        rm:
          description: "Remove objects by file path"
          usage: "supabase storage rm <path>..."

    # --- Project Management ---
    projects:
      description: "Manage Supabase projects"
      subcommands:
        api-keys:
          description: "List all API keys for a Supabase project"
          usage: "supabase projects api-keys"

        create:
          description: "Create a project on Supabase"
          usage: "supabase projects create <name>"

        delete:
          description: "Delete a Supabase project"
          usage: "supabase projects delete"

        list:
          description: "List all Supabase projects"
          usage: "supabase projects list"

    # --- Other Management Commands ---
    orgs:
      description: "Manage Supabase organizations"
      usage: "supabase orgs"

    branches:
      description: "Manage Supabase preview branches"
      usage: "supabase branches"

    config:
      description: "Manage Supabase project configurations"
      usage: "supabase config"

    domains:
      description: "Manage custom domain names for Supabase projects"
      usage: "supabase domains"

    backups:
      description: "Manage Supabase physical backups"
      usage: "supabase backups"

    inspect:
      description: "Tools to inspect your Supabase project"
      usage: "supabase inspect"

    seed:
      description: "Seed a Supabase project from supabase/config.toml"
      usage: "supabase seed"

    test:
      description: "Run tests on local Supabase containers"
      usage: "supabase test"

# ============================================================================
# WRANGLER CLI (CLOUDFLARE)
# ============================================================================

wrangler:
  version: "4.51.0"
  description: "Cloudflare Workers CLI - manage Workers, Pages, KV, D1, R2, and more"

  global_flags:
    - flag: "-c, --config <path>"
      description: "Path to Wrangler configuration file"
    - flag: "--cwd <path>"
      description: "Run as if Wrangler was started in the specified directory"
    - flag: "-e, --env <string>"
      description: "Environment to use for operations"
    - flag: "--env-file <path>"
      description: "Path to .env file to load (can be specified multiple times)"
    - flag: "-h, --help"
      description: "Show help"
    - flag: "-v, --version"
      description: "Show version number"

  commands:
    # --- Authentication ---
    login:
      description: "Login to Cloudflare"
      usage: "wrangler login [options]"
      flags:
        - flag: "--scopes-list"
          description: "List all available OAuth scopes"
        - flag: "--browser"
          description: "Automatically open OAuth link in browser (default: true)"
        - flag: "--scopes <scopes>"
          description: "Pick the set of OAuth scopes when logging in"

    logout:
      description: "Logout from Cloudflare"
      usage: "wrangler logout"

    whoami:
      description: "Retrieve your user information"
      usage: "wrangler whoami"

    # --- Project Setup ---
    init:
      description: "Initialize a basic Worker"
      usage: "wrangler init [name] [options]"
      flags:
        - flag: "-y, --yes"
          description: "Answer 'yes' to any prompts"
        - flag: "--from-dash <name>"
          description: "Download Worker from Cloudflare dashboard for local development"

    # --- Development ---
    dev:
      description: "Start a local server for developing your Worker"
      usage: "wrangler dev [script] [options]"
      flags:
        - flag: "--name <string>"
          description: "Name of the Worker"
        - flag: "--port <number>"
          description: "Port to listen on"
        - flag: "--ip <string>"
          description: "IP address to listen on"
        - flag: "--inspector-port <number>"
          description: "Port for devtools to connect to"
        - flag: "-r, --remote"
          description: "Run on global Cloudflare network with production resources"
        - flag: "-l, --local"
          description: "Run locally with remote bindings disabled"
        - flag: "--persist-to <path>"
          description: "Directory for local persistence (default: .wrangler/state)"
        - flag: "--live-reload"
          description: "Auto reload HTML pages when change detected"
        - flag: "--var <KEY=VALUE>"
          description: "Inject key-value pairs as variables"
        - flag: "--compatibility-date <date>"
          description: "Date for compatibility checks"
        - flag: "--log-level <level>"
          description: "Logging level"
          choices: ["debug", "info", "log", "warn", "error", "none"]

    # --- Deployment ---
    deploy:
      description: "Deploy a Worker to Cloudflare"
      usage: "wrangler deploy [script] [options]"
      flags:
        - flag: "--name <string>"
          description: "Name of the Worker"
        - flag: "--dry-run"
          description: "Don't actually deploy"
        - flag: "--minify"
          description: "Minify the Worker"
        - flag: "--keep-vars"
          description: "Don't delete existing vars before deployment"
        - flag: "--var <KEY=VALUE>"
          description: "Inject key-value pairs as variables"
        - flag: "--routes, --route <routes>"
          description: "Routes to upload"
        - flag: "--domains, --domain <domains>"
          description: "Custom domains to deploy to"
        - flag: "--triggers, --schedule <cron>"
          description: "Cron schedules to attach"
        - flag: "--upload-source-maps"
          description: "Include source maps when uploading"
        - flag: "--compatibility-date <date>"
          description: "Date for compatibility checks"

    delete:
      description: "Delete a Worker from Cloudflare"
      usage: "wrangler delete [script]"

    # --- Logs & Debugging ---
    tail:
      description: "Start a log tailing session for a Worker"
      usage: "wrangler tail [worker] [options]"
      flags:
        - flag: "--format <format>"
          description: "Format of log entries"
          choices: ["json", "pretty"]
        - flag: "--status <status>"
          description: "Filter by invocation status"
          choices: ["ok", "error", "canceled"]
        - flag: "--method <methods>"
          description: "Filter by HTTP method"
        - flag: "--search <string>"
          description: "Filter by text match in console.log"
        - flag: "--ip <ips>"
          description: "Filter by IP address (use 'self' for your own IP)"
        - flag: "--sampling-rate <number>"
          description: "Percentage of requests to log"

    # --- Secrets ---
    secret:
      description: "Manage Worker secrets"
      usage: "wrangler secret <command>"
      subcommands:
        put:
          description: "Create or update a secret"
          usage: "wrangler secret put <key>"
        delete:
          description: "Delete a secret"
          usage: "wrangler secret delete <key>"
        list:
          description: "List all secrets"
          usage: "wrangler secret list"
        bulk:
          description: "Bulk upload secrets from file"
          usage: "wrangler secret bulk [file]"

    # --- KV Storage ---
    kv:
      description: "Manage Workers KV Namespaces"
      usage: "wrangler kv <command>"
      subcommands:
        namespace:
          description: "Interact with KV namespaces"
          subcommands:
            create:
              description: "Create a new namespace"
              usage: "wrangler kv namespace create <namespace>"
            list:
              description: "List all namespaces"
              usage: "wrangler kv namespace list"
            delete:
              description: "Delete a namespace"
              usage: "wrangler kv namespace delete"
            rename:
              description: "Rename a namespace"
              usage: "wrangler kv namespace rename [old-name]"
        key:
          description: "Manage individual KV key-value pairs"
          usage: "wrangler kv key <command>"
        bulk:
          description: "Interact with multiple KV pairs at once"
          usage: "wrangler kv bulk <command>"

    # --- D1 Database ---
    d1:
      description: "Manage Workers D1 databases"
      usage: "wrangler d1 <command>"
      subcommands:
        list:
          description: "List D1 databases"
          usage: "wrangler d1 list"
        info:
          description: "Get database information"
          usage: "wrangler d1 info <name>"
        create:
          description: "Create D1 database"
          usage: "wrangler d1 create <name>"
        delete:
          description: "Delete D1 database"
          usage: "wrangler d1 delete <name>"
        execute:
          description: "Execute SQL command or file"
          usage: "wrangler d1 execute <database> [options]"
          flags:
            - flag: "--local"
              description: "Execute against local DB"
            - flag: "--remote"
              description: "Execute against remote DB"
            - flag: "--file <path>"
              description: "SQL file to ingest"
            - flag: "--command <sql>"
              description: "Single SQL statement to execute"
            - flag: "--json"
              description: "Return output as JSON"
        export:
          description: "Export database as .sql file"
          usage: "wrangler d1 export <name>"
        time-travel:
          description: "Restore, fork, or copy database at point-in-time"
          usage: "wrangler d1 time-travel"
        migrations:
          description: "Manage D1 migrations"
          subcommands:
            list:
              description: "List migrations"
              usage: "wrangler d1 migrations list <database>"
            create:
              description: "Create new migration"
              usage: "wrangler d1 migrations create <database> <message>"
            apply:
              description: "Apply migrations"
              usage: "wrangler d1 migrations apply <database>"

    # --- R2 Storage ---
    r2:
      description: "Manage R2 buckets & objects"
      usage: "wrangler r2 <command>"
      subcommands:
        bucket:
          description: "Manage R2 buckets"
          subcommands:
            create:
              description: "Create a new bucket"
              usage: "wrangler r2 bucket create <name>"
            list:
              description: "List R2 buckets"
              usage: "wrangler r2 bucket list"
            info:
              description: "Get bucket information"
              usage: "wrangler r2 bucket info <bucket>"
            delete:
              description: "Delete a bucket"
              usage: "wrangler r2 bucket delete <bucket>"
        object:
          description: "Manage R2 objects"
          usage: "wrangler r2 object <command>"
        sql:
          description: "R2 SQL queries (open-beta)"
          usage: "wrangler r2 sql"

    # --- Queues ---
    queues:
      description: "Manage Workers Queues"
      usage: "wrangler queues <command>"
      subcommands:
        list:
          description: "List queues"
          usage: "wrangler queues list"
        create:
          description: "Create a queue"
          usage: "wrangler queues create <name>"
        update:
          description: "Update a queue"
          usage: "wrangler queues update <name>"
        delete:
          description: "Delete a queue"
          usage: "wrangler queues delete <name>"
        info:
          description: "Get queue information"
          usage: "wrangler queues info <name>"
        consumer:
          description: "Configure queue consumers"
          usage: "wrangler queues consumer"
        pause-delivery:
          description: "Pause message delivery"
          usage: "wrangler queues pause-delivery <name>"
        resume-delivery:
          description: "Resume message delivery"
          usage: "wrangler queues resume-delivery <name>"
        purge:
          description: "Purge messages from queue"
          usage: "wrangler queues purge <name>"

    # --- Vectorize ---
    vectorize:
      description: "Manage Vectorize indexes"
      usage: "wrangler vectorize <command>"
      subcommands:
        create:
          description: "Create a Vectorize index"
          usage: "wrangler vectorize create <name>"
        delete:
          description: "Delete a Vectorize index"
          usage: "wrangler vectorize delete <name>"
        get:
          description: "Get index by name"
          usage: "wrangler vectorize get <name>"
        list:
          description: "List Vectorize indexes"
          usage: "wrangler vectorize list"
        insert:
          description: "Insert vectors into index"
          usage: "wrangler vectorize insert <name>"
        upsert:
          description: "Upsert vectors into index"
          usage: "wrangler vectorize upsert <name>"
        query:
          description: "Query a Vectorize index"
          usage: "wrangler vectorize query <name>"
        info:
          description: "Get index details"
          usage: "wrangler vectorize info <name>"

    # --- Hyperdrive ---
    hyperdrive:
      description: "Manage Hyperdrive database connections"
      usage: "wrangler hyperdrive <command>"
      subcommands:
        create:
          description: "Create a Hyperdrive config"
          usage: "wrangler hyperdrive create <name>"
        delete:
          description: "Delete a Hyperdrive config"
          usage: "wrangler hyperdrive delete <id>"
        get:
          description: "Get a Hyperdrive config"
          usage: "wrangler hyperdrive get <id>"
        list:
          description: "List Hyperdrive configs"
          usage: "wrangler hyperdrive list"
        update:
          description: "Update a Hyperdrive config"
          usage: "wrangler hyperdrive update <id>"

    # --- Pages ---
    pages:
      description: "Configure Cloudflare Pages"
      usage: "wrangler pages <command>"
      subcommands:
        dev:
          description: "Develop Pages application locally"
          usage: "wrangler pages dev [directory] [options]"
          flags:
            - flag: "--port <number>"
              description: "Port to listen on"
            - flag: "--ip <string>"
              description: "IP address to listen on"
            - flag: "--live-reload"
              description: "Auto reload HTML pages on change"
            - flag: "-b, --binding <KEY=VALUE>"
              description: "Bind variable/secret"
            - flag: "-k, --kv <binding>"
              description: "KV namespace to bind"
            - flag: "--d1 <binding>"
              description: "D1 database to bind"
            - flag: "--r2 <binding>"
              description: "R2 bucket to bind"
            - flag: "--ai <binding>"
              description: "AI to bind"
            - flag: "--persist-to <path>"
              description: "Directory for local persistence"
        deploy:
          description: "Deploy static assets as Pages deployment"
          usage: "wrangler pages deploy [directory] [options]"
          flags:
            - flag: "--project-name <name>"
              description: "Project name to deploy to"
            - flag: "--branch <name>"
              description: "Branch name to deploy to"
            - flag: "--commit-hash <sha>"
              description: "SHA to attach to deployment"
            - flag: "--commit-message <msg>"
              description: "Commit message to attach"
            - flag: "--upload-source-maps"
              description: "Upload server-side sourcemaps"
        project:
          description: "Interact with Pages projects"
          usage: "wrangler pages project"
        deployment:
          description: "Interact with project deployments"
          usage: "wrangler pages deployment"
        secret:
          description: "Manage Pages secrets"
          usage: "wrangler pages secret"

    # --- AI ---
    ai:
      description: "Manage AI models"
      usage: "wrangler ai <command>"
      subcommands:
        models:
          description: "List catalog models"
          usage: "wrangler ai models"
        finetune:
          description: "Interact with finetune files"
          usage: "wrangler ai finetune"

    # --- Deployments & Versions ---
    deployments:
      description: "List and view current/past deployments"
      usage: "wrangler deployments"

    versions:
      description: "List, view, upload, and deploy Worker versions"
      usage: "wrangler versions"

    rollback:
      description: "Rollback a deployment"
      usage: "wrangler rollback [version-id]"

    # --- Utilities ---
    types:
      description: "Generate types from Worker configuration"
      usage: "wrangler types [path]"

    docs:
      description: "Open Wrangler documentation in browser"
      usage: "wrangler docs [search..]"

# ============================================================================
# INFISICAL CLI
# ============================================================================

infisical:
  version: "0.43.35"
  description: "End-to-end encrypted secret management for teams"
  note: "Self-hosted instance at infisical.jefahnierocks.com"

  global_flags:
    - flag: "--domain <string>"
      description: "Point CLI to your Infisical instance (default: https://app.infisical.com/api)"
      note: "Set via INFISICAL_API_URL env var. Use https://infisical.jefahnierocks.com for this project"
    - flag: "-l, --log-level <string>"
      description: "Log level (trace, debug, info, warn, error, fatal)"
    - flag: "--silent"
      description: "Disable output of tip/info messages. Useful for scripts/CI"
    - flag: "--telemetry"
      description: "Enable telemetry (default: true)"

  commands:
    # --- Authentication ---
    login:
      description: "Login into your Infisical account"
      usage: "infisical login [options]"
      flags:
        - flag: "--method <string>"
          description: "Login method"
          choices: ["user", "universal-auth", "kubernetes", "azure", "gcp-id-token", "gcp-iam", "aws-iam", "oidc-auth"]
          default: "user"
        - flag: "-i, --interactive"
          description: "Login via command line"
        - flag: "--client-id <string>"
          description: "Client ID for universal auth"
        - flag: "--client-secret <string>"
          description: "Client secret for universal auth"
        - flag: "--email <string>"
          description: "Email for 'user' login method"
        - flag: "--password <string>"
          description: "Password for 'user' login method"
        - flag: "--organization-id <string>"
          description: "Organization ID for 'user' login method"
        - flag: "--machine-identity-id <string>"
          description: "Machine identity ID for kubernetes/azure/gcp/aws auth"
        - flag: "--jwt <string>"
          description: "JWT for oidc-auth/jwt-auth methods"
        - flag: "--plain"
          description: "Only output the token without formatting"
        - flag: "--clear-domains"
          description: "Clear all self-hosting domains from config"

    # --- Project Setup ---
    init:
      description: "Connect local project with Infisical project"
      usage: "infisical init"
      note: "Creates .infisical.json in project root"

    # --- Secret Operations ---
    secrets:
      description: "Create, read, update, and delete secrets"
      usage: "infisical secrets [options]"
      flags:
        - flag: "--env <string>"
          description: "Environment name (default: dev)"
        - flag: "--path <string>"
          description: "Folder path for secrets (default: /)"
        - flag: "--projectId <string>"
          description: "Project ID (for machine identity auth)"
        - flag: "--token <string>"
          description: "Service token or machine identity access token"
        - flag: "-o, --output <string>"
          description: "Output format"
          choices: ["yaml", "json", "dotenv"]
        - flag: "--expand"
          description: "Parse shell parameter expansions (default: true)"
        - flag: "--include-imports"
          description: "Include imported linked secrets (default: true)"
        - flag: "--recursive"
          description: "Fetch secrets from all sub-folders"
        - flag: "--secret-overriding"
          description: "Prioritize personal over shared secrets (default: true)"
        - flag: "-t, --tags <string>"
          description: "Filter secrets by tag slugs"
      subcommands:
        get:
          description: "Retrieve secrets by name"
          usage: "infisical secrets get <secret names...> [options]"
          examples:
            - "infisical secrets get API_KEY"
            - "infisical secrets get API_KEY DB_URL --env=prod"
            - "infisical secrets get API_KEY --plain"
          flags:
            - flag: "--plain"
              description: "Print values without formatting, one per line"
            - flag: "--recursive"
              description: "Fetch from all sub-folders"

        set:
          description: "Set secrets"
          usage: "infisical secrets set <KEY=VALUE>... [options]"
          examples:
            - "infisical secrets set API_KEY=secret123"
            - "infisical secrets set API_KEY=secret DB_URL=postgres://..."
            - "infisical secrets set SECRET=@/path/to/file"
            - "infisical secrets set --file=.env"
          flags:
            - flag: "--file <string>"
              description: "Load secrets from file (.env or YAML)"
            - flag: "--type <string>"
              description: "Secret type: personal or shared (default: shared)"

        delete:
          description: "Delete secrets by name"
          usage: "infisical secrets delete <secret names...> [options]"
          examples:
            - "infisical secrets delete API_KEY"
            - "infisical secrets delete API_KEY DB_URL --env=prod"
          flags:
            - flag: "--type <string>"
              description: "Secret type: personal or shared (default: personal)"

        folders:
          description: "Manage secret folders"
          usage: "infisical secrets folders <command>"
          subcommands:
            create:
              description: "Create a folder"
              usage: "infisical secrets folders create"
            delete:
              description: "Delete a folder"
              usage: "infisical secrets folders delete"
            get:
              description: "List folders in a directory"
              usage: "infisical secrets folders get"

        generate-example-env:
          description: "Generate example .env file"
          usage: "infisical secrets generate-example-env"

    # --- Run with Secrets ---
    run:
      description: "Inject environment variables into application process"
      usage: "infisical run [options] -- <command>"
      examples:
        - "infisical run --env=dev -- npm run dev"
        - "infisical run --env=prod -- node server.js"
        - "infisical run --command \"npm install && npm run dev\""
        - "infisical run --watch -- npm run dev"
      flags:
        - flag: "-e, --env <string>"
          description: "Environment (dev, staging, prod) (default: dev)"
        - flag: "--path <string>"
          description: "Folder path for secrets (default: /)"
        - flag: "-c, --command <string>"
          description: "Chained commands to execute"
        - flag: "--projectId <string>"
          description: "Project ID (for machine identity auth)"
        - flag: "--token <string>"
          description: "Service token or machine identity access token"
        - flag: "--expand"
          description: "Parse shell parameter expansions (default: true)"
        - flag: "--include-imports"
          description: "Include imported linked secrets (default: true)"
        - flag: "--recursive"
          description: "Fetch secrets from all sub-folders"
        - flag: "--secret-overriding"
          description: "Prioritize personal secrets (default: true)"
        - flag: "-t, --tags <string>"
          description: "Filter secrets by tag slugs"
        - flag: "--watch"
          description: "Reload application when secrets change"
        - flag: "--watch-interval <int>"
          description: "Interval in seconds to check for changes (default: 10)"
        - flag: "--project-config-dir <string>"
          description: "Directory containing .infisical.json"

    # --- Export Secrets ---
    export:
      description: "Export environment variables to a file"
      usage: "infisical export [options]"
      examples:
        - "infisical export --env=prod --format=json > secrets.json"
        - "infisical export --env=dev --format=dotenv -o .env.local"
        - "infisical export --template=template.tpl"
      flags:
        - flag: "-e, --env <string>"
          description: "Environment (default: dev)"
        - flag: "-f, --format <string>"
          description: "Output format (default: dotenv)"
          choices: ["dotenv", "json", "csv"]
        - flag: "-o, --output-file <string>"
          description: "Path to write output file"
        - flag: "--path <string>"
          description: "Folder path for secrets (default: /)"
        - flag: "--projectId <string>"
          description: "Project ID (for machine identity auth)"
        - flag: "--token <string>"
          description: "Service token or machine identity access token"
        - flag: "--template <string>"
          description: "Path to template file for rendering secrets"
        - flag: "--expand"
          description: "Parse shell parameter expansions (default: true)"
        - flag: "--include-imports"
          description: "Include imported linked secrets (default: true)"
        - flag: "--secret-overriding"
          description: "Prioritize personal secrets (default: true)"
        - flag: "-t, --tags <string>"
          description: "Filter secrets by tag slugs"

    # --- Secret Scanning ---
    scan:
      description: "Scan for leaked secrets in git history, directories, and files"
      usage: "infisical scan [options]"
      examples:
        - "infisical scan"
        - "infisical scan --source=./src"
        - "infisical scan -v --report-path=scan-results.json"
        - "cat file | infisical scan --pipe"
      flags:
        - flag: "-s, --source <string>"
          description: "Path to source (default: .)"
        - flag: "-v, --verbose"
          description: "Show verbose output (file, location, secret)"
        - flag: "-f, --report-format <string>"
          description: "Output format (default: json)"
          choices: ["json", "csv", "sarif"]
        - flag: "-r, --report-path <string>"
          description: "Path to save report file"
        - flag: "-b, --baseline-path <string>"
          description: "Path to baseline with ignorable issues"
        - flag: "-c, --config <string>"
          description: "Config file path"
        - flag: "--exit-code <int>"
          description: "Exit code when leaks found (default: 1)"
        - flag: "--no-git"
          description: "Treat git repo as regular directory"
        - flag: "--pipe"
          description: "Scan input from stdin"
        - flag: "--redact"
          description: "Redact secrets from output"
        - flag: "--follow-symlinks"
          description: "Scan symlinked files"
        - flag: "--max-target-megabytes <int>"
          description: "Skip files larger than this"
        - flag: "--no-color"
          description: "Disable colored output"
      subcommands:
        git-changes:
          description: "Scan for secrets in uncommitted changes"
          usage: "infisical scan git-changes"
        install:
          description: "Install scanning scripts and tools"
          usage: "infisical scan install"

    # --- Agent Mode ---
    agent:
      description: "Launch client daemon for streamlined auth and secret retrieval"
      usage: "infisical agent [options]"
      flags:
        - flag: "--config <string>"
          description: "Path to agent config yaml file (default: agent-config.yaml)"

    # --- Token Management ---
    token:
      description: "Manage access tokens"
      usage: "infisical token [command]"
      subcommands:
        renew:
          description: "Renew universal auth access token"
          usage: "infisical token renew"

    # --- User Management ---
    user:
      description: "Manage local user credentials"
      usage: "infisical user [command]"
      subcommands:
        get:
          description: "Get properties of an Infisical profile"
          usage: "infisical user get"
        switch:
          description: "Switch between Infisical profiles"
          usage: "infisical user switch"
        update:
          description: "Update properties of an Infisical profile"
          usage: "infisical user update"

    # --- Vault Configuration ---
    vault:
      description: "Manage where login token is saved"
      usage: "infisical vault [command]"
      subcommands:
        set:
          description: "Configure vault backends"
          usage: "infisical vault set"

    # --- Other Commands ---
    reset:
      description: "Delete all Infisical related data on machine"
      usage: "infisical reset"

    service-token:
      description: "Manage service tokens"
      usage: "infisical service-token"

    dynamic-secrets:
      description: "List dynamic secrets"
      usage: "infisical dynamic-secrets"

    ssh:
      description: "Issue SSH credentials"
      usage: "infisical ssh"

# ============================================================================
# INFISICAL RUST SDK
# ============================================================================

infisical_rust_sdk:
  crate: "infisical"
  install: "cargo add infisical"
  description: "Official Infisical Rust SDK for secret management"

  client:
    builder: "Client::builder()"
    methods:
      - name: ".base_url(url)"
        description: "Set custom Infisical instance URL"
        default: "https://app.infisical.com"
      - name: ".build().await"
        description: "Build the client"
      - name: "client.login(auth_method).await"
        description: "Authenticate the client"
      - name: "client.secrets()"
        description: "Access secret operations"
      - name: "client.kms()"
        description: "Access KMS operations"

  auth_methods:
    universal_auth:
      code: 'AuthMethod::new_universal_auth("<client-id>", "<client-secret>")'

  secrets:
    get:
      code: |
        GetSecretRequest::builder("SECRET_NAME", "<project-id>", "dev")
            .path("/")
            .build()
      method: "client.secrets().get(request).await"

    list:
      code: |
        ListSecretsRequest::builder("<project-id>", "dev")
            .path("/")
            .recursive(true)
            .build()
      method: "client.secrets().list(request).await"

    create:
      code: |
        CreateSecretRequest::builder("SECRET_NAME", "value", "<project-id>", "dev")
            .path("/")
            .secret_comment("comment")
            .build()
      method: "client.secrets().create(request).await"

    update:
      code: |
        UpdateSecretRequest::builder("SECRET_NAME", "<project-id>", "dev")
            .secret_value("new-value")
            .build()
      method: "client.secrets().update(request).await"

    delete:
      code: |
        DeleteSecretRequest::builder("SECRET_NAME", "<project-id>", "dev")
            .path("/")
            .build()
      method: "client.secrets().delete(request).await"

  kms:
    operations:
      - list: "ListKmsKeysRequest::builder(project_id)"
      - get: "GetKmsKeyRequest::builder(key_id)"
      - get_by_name: "GetKmsKeyByNameRequest::builder(key_name)"
      - create: "CreateKmsKeyRequest::builder(project_id, name)"
      - update: "UpdateKmsKeyRequest::builder(key_id)"
      - delete: "DeleteKmsKeyRequest::builder(key_id)"
      - encrypt: "EncryptRequest::builder(key_id, plaintext)"
      - decrypt: "DecryptRequest::builder(key_id, ciphertext)"
      - sign: "SignRequest::builder(key_id, data)"
      - verify: "VerifyRequest::builder(key_id, data, signature)"

  helpers:
    - "encode_base64(data: &str) -> String"
    - "decode_base64(data: &str) -> Result<String, InfisicalError>"

  env_vars:
    - "INFISICAL_CLIENT_ID"
    - "INFISICAL_CLIENT_SECRET"
    - "INFISICAL_BASE_URL"
    - "INFISICAL_SECRETS_PROJECT_ID"

# ============================================================================
# COMMON WORKFLOWS
# ============================================================================

workflows:
  supabase:
    local_development:
      description: "Start local Supabase development environment"
      steps:
        - "supabase init          # Initialize project (first time only)"
        - "supabase start         # Start local containers"
        - "supabase status        # Verify services are running"
        - "supabase db reset      # Reset database if needed"
        - "supabase stop          # Stop when done"

    database_migrations:
      description: "Create and apply database migrations"
      steps:
        - "supabase migration new <name>  # Create new migration"
        - "# Edit the migration file in supabase/migrations/"
        - "supabase db reset              # Apply locally"
        - "supabase db push               # Push to remote"

    type_generation:
      description: "Generate TypeScript types from database schema"
      steps:
        - "supabase gen types --local > src/lib/types/database.ts"
        - "# Or from linked project:"
        - "supabase gen types --linked > src/lib/types/database.ts"

    edge_functions:
      description: "Develop and deploy Edge Functions"
      steps:
        - "supabase functions new <name>  # Create new function"
        - "supabase functions serve       # Serve locally for testing"
        - "supabase functions deploy      # Deploy to production"

    link_project:
      description: "Link local project to remote Supabase project"
      steps:
        - "supabase login                          # Authenticate"
        - "supabase projects list                  # Find project ref"
        - "supabase link --project-ref <ref>       # Link project"

  durable_objects:
    description: "Cloudflare Durable Objects for multiplayer infrastructure"
    migration_guide: "docs/dicee-do-migration-guide.md"

    local_development:
      description: "Develop Durable Objects locally"
      steps:
        - "cd packages/cloudflare-do     # Navigate to DO package"
        - "wrangler dev                  # Start local dev server"
        - "wrangler dev --remote         # Use remote DO bindings"
        - "# Test with wscat: wscat -c ws://localhost:8787/room/test-room"

    deployment:
      description: "Deploy Durable Objects to Cloudflare"
      steps:
        - "wrangler deploy               # Deploy to production"
        - "wrangler tail                 # Stream production logs"
        - "wrangler tail --format json   # JSON log format for parsing"

    secrets_management:
      description: "Manage DO Worker secrets"
      steps:
        - "wrangler secret put SUPABASE_URL        # Set Supabase URL"
        - "wrangler secret put SUPABASE_ANON_KEY   # Set Supabase anon key"
        - "wrangler secret list                     # Verify secrets"

    custom_domain:
      description: "Configure custom domain for DO Worker"
      steps:
        - "# In wrangler.toml, add routes:"
        - "# routes = [{ pattern = 'gamelobby.jefahnierocks.com', custom_domain = true }]"
        - "wrangler deploy               # Deploy with custom domain"

    testing:
      description: "Test Durable Objects"
      steps:
        - "# Unit tests:"
        - "pnpm test --filter @dicee/cloudflare-do"
        - "# Integration tests with unstable_dev:"
        - "pnpm test:integration --filter @dicee/cloudflare-do"
        - "# Manual WebSocket test:"
        - "wscat -c wss://gamelobby.jefahnierocks.com/room/test"

  wrangler:
    authentication:
      description: "Authenticate with Cloudflare"
      steps:
        - "wrangler login                                  # Browser-based OAuth login"
        - "wrangler whoami                                 # Verify authentication"
        - "# Or use API token from gopass:"
        - "export CLOUDFLARE_API_TOKEN=$(gopass show -o dicee/cloudflare/api-token)"

    project_init:
      description: "Initialize a new Worker project"
      steps:
        - "wrangler init dicee-worker                      # Create new Worker"
        - "wrangler init --from-dash existing-worker       # Clone from dashboard"
        - "# Configure wrangler.toml with account_id and routes"

    local_development:
      description: "Develop Workers locally"
      steps:
        - "wrangler dev                                    # Start local dev server"
        - "wrangler dev --remote                           # Use remote resources"
        - "wrangler dev --local                            # Fully local (no remote bindings)"
        - "wrangler dev --port 8787                        # Custom port"
        - "wrangler dev --live-reload                      # Auto reload on changes"

    deployment:
      description: "Deploy Workers to Cloudflare"
      steps:
        - "wrangler deploy                                 # Deploy to production"
        - "wrangler deploy --dry-run                       # Preview deployment"
        - "wrangler deploy --env staging                   # Deploy to staging env"
        - "wrangler tail                                   # Stream production logs"
        - "wrangler tail --format json                     # JSON log format"

    pages_deployment:
      description: "Deploy SvelteKit to Cloudflare Pages (unified architecture)"
      steps:
        - "# Build SvelteKit with CF adapter:"
        - "pnpm build                                       # Build to .svelte-kit/cloudflare"
        - "# Deploy:"
        - "wrangler pages deploy .svelte-kit/cloudflare --project-name gamelobby-pages"
        - "wrangler pages deployment list --project-name gamelobby-pages"
        - "# Secrets:"
        - "wrangler pages secret put SUPABASE_SERVICE_KEY --project-name gamelobby-pages"
        - "wrangler pages secret list --project-name gamelobby-pages"
        - "# Local dev with Service Bindings:"
        - "wrangler pages dev .svelte-kit/cloudflare --compatibility-flags=nodejs_compat"

    pages_with_service_bindings:
      description: "Configure Pages to call Workers via Service Bindings"
      steps:
        - "# 1. Build and verify locally:"
        - "pnpm build && wrangler pages dev .svelte-kit/cloudflare"
        - "# 2. In CF Dashboard: Pages > Settings > Functions > Service Bindings"
        - "# 3. Add binding: GAME_WORKER → gamelobby"
        - "# 4. In SvelteKit server routes, use platform.env.GAME_WORKER"
        - "# 5. Deploy: wrangler pages deploy .svelte-kit/cloudflare --project-name gamelobby-pages"

    d1_database:
      description: "Manage D1 SQLite databases"
      steps:
        - "wrangler d1 create dicee-db                     # Create database"
        - "wrangler d1 list                                # List all databases"
        - "wrangler d1 execute dicee-db --file schema.sql  # Run migrations"
        - "wrangler d1 execute dicee-db --command 'SELECT * FROM users'"
        - "wrangler d1 export dicee-db --output backup.sql # Export database"

    kv_storage:
      description: "Manage KV namespaces"
      steps:
        - "wrangler kv namespace create dicee-kv           # Create namespace"
        - "wrangler kv namespace list                      # List namespaces"
        - "wrangler kv key put --binding KV key value      # Store value"
        - "wrangler kv key get --binding KV key            # Retrieve value"
        - "wrangler kv key list --binding KV               # List keys"
        - "wrangler kv bulk put --binding KV data.json     # Bulk import"

    r2_storage:
      description: "Manage R2 object storage"
      steps:
        - "wrangler r2 bucket create dicee-assets          # Create bucket"
        - "wrangler r2 bucket list                         # List buckets"
        - "wrangler r2 object put dicee-assets/file.txt --file ./local.txt"
        - "wrangler r2 object get dicee-assets/file.txt    # Download object"
        - "wrangler r2 object list dicee-assets            # List objects"

    secrets_management:
      description: "Manage Worker secrets"
      steps:
        - "wrangler secret put API_KEY                     # Set secret (prompts)"
        - "wrangler secret list                            # List all secrets"
        - "wrangler secret delete API_KEY                  # Delete secret"
        - "wrangler secret bulk secrets.json               # Bulk import from file"
        - "# Note: Can sync from Infisical to Wrangler secrets"

    queues:
      description: "Manage Cloudflare Queues"
      steps:
        - "wrangler queues create dicee-tasks              # Create queue"
        - "wrangler queues list                            # List queues"
        - "wrangler queues delete dicee-tasks              # Delete queue"
        - "# Configure queue bindings in wrangler.toml"

    ai_and_vectorize:
      description: "Work with Cloudflare AI and Vectorize"
      steps:
        - "wrangler ai models                              # List AI models"
        - "wrangler vectorize create dicee-vectors --dimensions 1536 --metric cosine"
        - "wrangler vectorize list                         # List indexes"
        - "wrangler vectorize insert dicee-vectors --file vectors.ndjson"
        - "wrangler vectorize query dicee-vectors --vector '[0.1, ...]'"

  infisical:
    initial_setup:
      description: "Initialize Infisical for a project (self-hosted)"
      steps:
        - "infisical login --domain=https://infisical.jefahnierocks.com"
        - "infisical init                                   # Link to project (creates .infisical.json)"
        - "# Select project: dicee (dicee-dsmc)"

    local_development:
      description: "Run app with secrets from Infisical"
      steps:
        - "infisical run --env=dev -- npm run dev          # Inject dev secrets"
        - "infisical run --env=dev --watch -- npm run dev  # Auto-reload on secret changes"
        - "infisical export --env=dev -o .env.local        # Export to .env file"

    secret_management:
      description: "Manage secrets in Infisical"
      steps:
        - "infisical secrets --env=dev                     # List all dev secrets"
        - "infisical secrets get API_KEY --env=prod        # Get specific secret"
        - "infisical secrets set API_KEY=value --env=dev   # Set a secret"
        - "infisical secrets delete OLD_KEY --env=dev      # Delete a secret"
        - "infisical secrets set --file=.env --env=dev     # Bulk import from file"

    environment_workflows:
      description: "Work with different environments"
      steps:
        - "infisical secrets --env=dev                     # Development"
        - "infisical secrets --env=staging                 # Staging"
        - "infisical secrets --env=prod                    # Production"
        - "infisical export --env=staging -o .env.staging  # Export staging secrets"

    ci_cd_integration:
      description: "Use Infisical in CI/CD pipelines"
      steps:
        - "# Set INFISICAL_TOKEN environment variable in CI"
        - "infisical run --token=$INFISICAL_TOKEN --env=prod -- npm run build"
        - "infisical export --token=$INFISICAL_TOKEN --env=prod --format=json"
        - "# Or use universal auth:"
        - "infisical login --method=universal-auth --client-id=$ID --client-secret=$SECRET"

    secret_scanning:
      description: "Scan for leaked secrets"
      steps:
        - "infisical scan                                  # Scan current directory"
        - "infisical scan --verbose                        # Detailed output"
        - "infisical scan git-changes                      # Scan uncommitted changes"
        - "infisical scan --report-path=scan.json          # Save report"

    rust_sdk_usage:
      description: "Use Infisical in Rust engine (packages/engine)"
      steps:
        - "cargo add infisical                             # Add to Cargo.toml"
        - "# Set env vars: INFISICAL_CLIENT_ID, INFISICAL_CLIENT_SECRET"
        - "# Use Client::builder().base_url(\"https://infisical.jefahnierocks.com\")"
        - "# Project ID: b15c7b9c-4e1f-447a-a326-4c382b6db706"

  gopass:
    credential_retrieval:
      description: "Retrieve credentials from gopass"
      steps:
        - "gopass show -o dicee/infisical/dev/client-id      # Get single value (no newline)"
        - "gopass show dicee/infisical/dev/client-id         # Show with metadata"
        - "gopass ls dicee                                    # List all dicee credentials"
        - "gopass ls dicee/infisical                          # List Infisical credentials"

    environment_setup:
      description: "Load credentials into environment"
      steps:
        - "dicee-env dev                                      # Fish: load dev credentials"
        - "dicee-env staging                                  # Fish: load staging credentials"
        - "dicee-env prod                                     # Fish: load prod credentials"
        - "dicee-env --clear                                  # Fish: clear credentials"

    infisical_auth_with_gopass:
      description: "Authenticate Infisical CLI using gopass credentials"
      steps:
        - "# Load credentials and login:"
        - "infisical login --method=universal-auth \\"
        - "  --client-id=$(gopass show -o dicee/infisical/dev/client-id) \\"
        - "  --client-secret=$(gopass show -o dicee/infisical/dev/client-secret) \\"
        - "  --domain=$(gopass show -o dicee/infisical/instance-url)"

    export_for_ci:
      description: "Export credentials for CI/CD use"
      steps:
        - "# Bash export:"
        - "export INFISICAL_CLIENT_ID=$(gopass show -o dicee/infisical/prod/client-id)"
        - "export INFISICAL_CLIENT_SECRET=$(gopass show -o dicee/infisical/prod/client-secret)"
        - "export INFISICAL_API_URL=$(gopass show -o dicee/infisical/instance-url)"

# ============================================================================
# GOPASS CREDENTIAL STRUCTURE
# ============================================================================

gopass_structure:
  description: "Local credential storage for dicee project services"
  root: "dicee"

  infisical:
    shared:
      instance_url: "dicee/infisical/instance-url"
      project_id: "dicee/infisical/project-id"
      project_slug: "dicee/infisical/project-slug"
      org_name: "dicee/infisical/org-name"

    environments:
      dev:
        identity_name: "dicee/infisical/dev/identity-name"
        identity_id: "dicee/infisical/dev/identity-id"
        client_id: "dicee/infisical/dev/client-id"
        client_secret: "dicee/infisical/dev/client-secret"

      staging:
        identity_name: "dicee/infisical/staging/identity-name"
        identity_id: "dicee/infisical/staging/identity-id"
        client_id: "dicee/infisical/staging/client-id"
        client_secret: "dicee/infisical/staging/client-secret"

      prod:
        identity_name: "dicee/infisical/prod/identity-name"
        identity_id: "dicee/infisical/prod/identity-id"
        client_id: "dicee/infisical/prod/client-id"
        client_secret: "dicee/infisical/prod/client-secret"

  github:
    pat: "dicee/github/pat"
    pat_name: "dicee/github/pat-name"
    pat_expiry: "dicee/github/pat-expiry"

  cloudflare:
    config:
      account_id: "dicee/cloudflare/account-id"
      zone_id: "dicee/cloudflare/zone-id"
      domain: "dicee/cloudflare/domain"
      subdomain: "dicee/cloudflare/subdomain"
    api_tokens:
      api_token: "dicee/cloudflare/api-token"
      token_name: "dicee/cloudflare/api-token-name"
      token_expiry: "dicee/cloudflare/api-token-expiry"

  # Reserved for future services
  supabase: "dicee/supabase/"
  # vercel: deprecated - now using Cloudflare Pages (no gopass needed)
  # partykit: deprecated - now using Cloudflare Workers/DOs (via cloudflare/ path)
